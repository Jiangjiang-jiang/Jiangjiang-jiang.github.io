<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <link rel="alternate icon" type="image/png" href="/img/favicon.png">
    <title>姜姜酱 | </title>
    
<link rel="stylesheet" href="/css/reset.css">

    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/markdown.css">

    
<link rel="stylesheet" href="/css/fonts.css">

<meta name="generator" content="Hexo 6.1.0"></head>
    <body>
        <div class="paper">
            <div class="paper-main">
                
                    <div class="post-header">
    <a class="logo" href="/">姜姜酱</a>
    <a class="go-home" href="/">
        <svg width="8" height="14" viewBox="0 0 8 14">
            <path d="M7 1L1 7l6 6" stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </a>
</div>
                
                <div class="post-main">

    
        <div class="post-main-title">
            BMZCTF2020 re &amp; crypto writeup
        </div>
        <div class="post-meta">
            2022-03-14
        </div>
    

    <div class="post-md">
        <p><a target="_blank" rel="noopener" href="https://share.weiyun.com/9Bz96oYq">题目链接</a></p>
<span id="more"></span>

<h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="re1"><a href="#re1" class="headerlink" title="re1"></a>re1</h3><p>64位程序，IDA查看。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4[<span class="number">30</span>]; <span class="comment">// [rsp+0h] [rbp-90h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+78h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [rsp+7Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> l; <span class="comment">// [rsp+80h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+84h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+88h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+8Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Hello,Reverser,Lets play a game (T_T)&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">27</span>; ++i )</span><br><span class="line">    v4[i] = getchar();</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">27</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v4[j] ^= <span class="number">0x1A2B3C</span>u;</span><br><span class="line">    encrypt_jump(<span class="number">0x1A2B3C</span>u);</span><br><span class="line">  &#125;</span><br><span class="line">  v5 = <span class="number">0x1A2B0C</span>;</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">27</span>; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    v4[k] %= v5;</span><br><span class="line">    encrypt_jump(v5);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( l = <span class="number">0</span>; l &lt;= <span class="number">27</span>; ++l )</span><br><span class="line">  &#123;</span><br><span class="line">    v4[l] ^= <span class="number">0x4D5E6F</span>u;</span><br><span class="line">    encrypt_jump(<span class="number">0x4D5E6F</span>u);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">27</span>; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( bytes_0318912x[m] != v4[m] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Sorry~&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Congratulations!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>v4数组是flag的值，让bytes_0318912x[m] &#x3D;&#x3D; v4[m]时候跳转到Congratulations处，encrypt_ jump()对v4没有影响，直接逆算法。注意在这里：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">27</span>; ++k )</span><br><span class="line">&#123;</span><br><span class="line">   v4[k] %= v5;</span><br><span class="line">   encrypt_jump(v5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按理说模运算并不容易复原，但尝试后发现这里只有倍数k&#x3D;1。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">bytes_0318912x = [<span class="number">0x4D5E21</span>,<span class="number">0x4D5E2B</span>,<span class="number">0x4D5E3E</span>,<span class="number">0x4D5E20</span>,</span><br><span class="line">                  <span class="number">0x4D5E54</span>,<span class="number">0x4D5E1D</span>,<span class="number">0x4D5E0A</span>,<span class="number">0x4D5E35</span>,</span><br><span class="line">                  <span class="number">0x4D5E1C</span>,<span class="number">0x4D5E33</span>,<span class="number">0x4D5E01</span>,<span class="number">0x4D5E38</span>,</span><br><span class="line">                  <span class="number">0x4D5E0D</span>,<span class="number">0x4D5E22</span>,<span class="number">0x4D5E32</span>,<span class="number">0x4D5E22</span>,</span><br><span class="line">                  <span class="number">0x4D5E37</span>,<span class="number">0x4D5E2C</span>,<span class="number">0x4D5E6C</span>,<span class="number">0x4D5E38</span>,</span><br><span class="line">                  <span class="number">0x4D5E6E</span>,<span class="number">0x4D5E2C</span>,<span class="number">0x4D5E38</span>,<span class="number">0x4D5E1C</span>,</span><br><span class="line">                  <span class="number">0x4D5E28</span>,<span class="number">0x4D5E6F</span>,<span class="number">0x4D5E6E</span>,<span class="number">0x4D5E5A</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">28</span>):</span><br><span class="line">        bytes_0318912x[i] ^= <span class="number">0x4D5E6F</span></span><br><span class="line">        bytes_0318912x[i] += <span class="number">0x1A2B0C</span></span><br><span class="line">        bytes_0318912x[i] ^= <span class="number">0x1A2B3C</span></span><br><span class="line">        flag += <span class="built_in">chr</span>(bytes_0318912x[i])</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(attack())</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;BMZCTF_ReUeXs3_1s_Co01&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="re2"><a href="#re2" class="headerlink" title="re2"></a>re2</h3><p>64位程序，IDA查看伪代码。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4[<span class="number">30</span>]; <span class="comment">// [rsp+0h] [rbp-80h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+7Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(&amp;s);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">26</span>; ++i )</span><br><span class="line">    v4[i] = getchar();</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)Auth(v4, argv) == <span class="number">1</span> )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Congratulations!~&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;tryyyyy again&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>当输入字符串v4满足Auth(v4, argv) &#x3D;&#x3D; 1时，打印出”Congratulations!~”，v4为flag值。进入Auth函数，a1&#x3D;v4。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">signed</span> __int64 __fastcall <span class="title function_">Auth</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2[<span class="number">12</span>]; <span class="comment">// [rsp+8h] [rbp-C0h]</span></span><br><span class="line">  <span class="type">int</span> v3[<span class="number">12</span>]; <span class="comment">// [rsp+38h] [rbp-90h]</span></span><br><span class="line">  <span class="type">int</span> v4[<span class="number">12</span>]; <span class="comment">// [rsp+68h] [rbp-60h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+98h] [rbp-30h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+A0h] [rbp-28h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+A8h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+B0h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+B4h] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+B8h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+BCh] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+C0h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+C4h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v13 &lt;= <span class="number">8</span> )</span><br><span class="line">    v4[v13++] = *(_DWORD *)(<span class="number">4LL</span> * v12-- + a1) ^ <span class="number">0xCE2</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">9</span>; i &lt;= <span class="number">17</span>; ++i )</span><br><span class="line">    v3[i - <span class="number">9</span>] = *(_DWORD *)(<span class="number">4LL</span> * i + a1) ^ <span class="number">0xFFF</span>;</span><br><span class="line">  v10 = <span class="number">18</span>;</span><br><span class="line">  v9 = <span class="number">26</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v10 &lt;= <span class="number">26</span> )</span><br><span class="line">    v2[v10++ - <span class="number">18</span>] = *(_DWORD *)(<span class="number">4LL</span> * v9-- + a1) ^ <span class="number">0x4EA</span>;</span><br><span class="line">  v7 = SboxExchangeA(&amp;SboxA, v4);</span><br><span class="line">  v6 = SboxExchangeB(&amp;SboxB, v3);</span><br><span class="line">  v5 = SboxExchangeC(&amp;SboxC, v2);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">8</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( bytes_0x0001[j] != *(_DWORD *)(<span class="number">4LL</span> * j + v7) )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">    <span class="keyword">if</span> ( bytes_0x0002[j] != *(_DWORD *)(<span class="number">4LL</span> * j + v6) )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *((_DWORD *)&amp;bytes_0x0003 + j) != *(_DWORD *)(<span class="number">4LL</span> * j + v5) )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现最终要使Auth()返回 1，那么就要满足bytes_0x0001[j] &#x3D; v7[j]，bytes_0x0002[j]&#x3D;v6[j]，bytes_0x0003[j]&#x3D;v5[j]。bytes_0x0001，bytes_0x0002，bytes_0x0003可以直接查看，那么需要知道v5，v6，v7的值。v5，v6，v7由v2，v3，v4经过S盒得出。如果推出v2，v3，v4的值，根据前面的循环，可以拼凑出a1的值。3个S盒：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__fastcall <span class="title function_">SboxExchangeA</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">    final_2323[i] = *(_DWORD *)(<span class="number">4LL</span> * *(<span class="type">signed</span> <span class="type">int</span> *)(<span class="number">4LL</span> * i + a1) + a2);</span><br><span class="line">  <span class="keyword">return</span> final_2323;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__fastcall <span class="title function_">SboxExchangeB</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">    final_2332[i] = *(_DWORD *)(<span class="number">4LL</span> * *(<span class="type">signed</span> <span class="type">int</span> *)(<span class="number">4LL</span> * i + a1) + a2);</span><br><span class="line">  <span class="keyword">return</span> final_2332;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__fastcall <span class="title function_">SboxExchangeC</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">    final_2341[i] = *(_DWORD *)(<span class="number">4LL</span> * *(<span class="type">signed</span> <span class="type">int</span> *)(<span class="number">4LL</span> * i + a1) + a2);</span><br><span class="line">  <span class="keyword">return</span> final_2341;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现3个S盒只是简单的异或运算，直接异或回去就好。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">bytes_0x0001 = [<span class="number">0x0C8E</span>, <span class="number">0x0C85</span>, <span class="number">0x0C87</span>, <span class="number">0x0C99</span>, <span class="number">0x0CA4</span>, <span class="number">0x0CD1</span>, <span class="number">0x0C83</span>, <span class="number">0x0C8E</span>, <span class="number">0x0C84</span>]</span><br><span class="line">bytes_0x0002 = [<span class="number">0x0F9A</span>, <span class="number">0x0F8B</span>, <span class="number">0x0FA0</span>, <span class="number">0x0FCF</span>, <span class="number">0x0F8D</span>, <span class="number">0x0FA0</span>, <span class="number">0x0FB9</span>, <span class="number">0x0F9E</span>, <span class="number">0x0FA0</span>]</span><br><span class="line">bytes_0x0003 = [<span class="number">0x48F</span>,<span class="number">0x499</span>,<span class="number">0x48F</span>,<span class="number">0x497</span>,<span class="number">0x4DD</span>,<span class="number">0x4B5</span>,<span class="number">0x49C</span>,<span class="number">0x482</span>,<span class="number">0x4B8</span>]</span><br><span class="line">sboxa = [<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">sboxb = [<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">sboxc = [<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SboxExchangeA</span>():</span><br><span class="line">  final_2323 = [<span class="string">&#x27;0&#x27;</span>] * <span class="number">9</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">9</span>):</span><br><span class="line">      final_2323[i] =  bytes_0x0001[sboxa[<span class="number">4</span>*i]]</span><br><span class="line">  <span class="keyword">return</span> final_2323</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SboxExchangeB</span>():</span><br><span class="line">  final_2323 = [<span class="string">&#x27;0&#x27;</span>] * <span class="number">9</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">9</span>):</span><br><span class="line">      final_2323[i] =  bytes_0x0002[sboxb[<span class="number">4</span>*i]]</span><br><span class="line">  <span class="keyword">return</span> final_2323</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SboxExchangeC</span>():</span><br><span class="line">  final_2341 = [<span class="string">&#x27;0&#x27;</span>] * <span class="number">9</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">9</span>):</span><br><span class="line">      final_2341[i] =  bytes_0x0003[sboxc[<span class="number">4</span>*i]]</span><br><span class="line">  <span class="keyword">return</span> final_2341</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">  v4 = SboxExchangeA()</span><br><span class="line">  v3 = SboxExchangeB()</span><br><span class="line">  v2 = SboxExchangeC()</span><br><span class="line">  a1 = [<span class="string">&#x27;*&#x27;</span>] * <span class="number">27</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">9</span>):</span><br><span class="line">    a1[<span class="number">8</span>-i] = v4[i] ^ <span class="number">0xCE2</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">18</span>):</span><br><span class="line">    a1[i] = v3[i - <span class="number">9</span>] ^ <span class="number">0xFFF</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>, <span class="number">27</span>):</span><br><span class="line">    a1[<span class="number">44</span> - i] = v2[i - <span class="number">18</span>] ^ <span class="number">0x4EA</span></span><br><span class="line">  flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> a1:</span><br><span class="line">    flag += <span class="built_in">chr</span>(i)</span><br><span class="line">  <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(attack())</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;Fe3l_Fear_t0_7he_Revs&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="re3"><a href="#re3" class="headerlink" title="re3"></a>re3</h3><p>apk文件解压之后dex2jar转为jar文件，jd-gui打开。可以看到有两个Activity：MainActivity.class和FlagActivity.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MainActivity.class</span></span><br><span class="line"><span class="keyword">package</span> com.ctfgame.bmzctf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.pm.Signature;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="variable">Globalhit</span> <span class="operator">=</span> <span class="number">999999</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkSignature</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> (getPackageManager().getPackageInfo(getPackageName(), <span class="number">64</span>)).signatures[<span class="number">0</span>];</span><br><span class="line">      getMD5String(signature.toByteArray());</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">bool</span> <span class="operator">=</span> getMD5String(signature.toByteArray()).equals(<span class="string">&quot;E915DDE06E7090754E9ACD1DA29C052A&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> bool;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">      exception.printStackTrace();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">getMD5String</span><span class="params">(<span class="type">byte</span>[] paramArrayOfbyte)</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle paramBundle)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(paramBundle);</span><br><span class="line">    <span class="keyword">if</span> (!checkSignature())</span><br><span class="line">      System.exit(<span class="number">1</span>); </span><br><span class="line">    setContentView(<span class="number">2131361823</span>);</span><br><span class="line">    ((Button)findViewById(<span class="number">2131165265</span>)).setOnClickListener(<span class="keyword">new</span> <span class="title class_">Flag_listenser</span>());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Flag_listenser</span> <span class="keyword">implements</span> <span class="title class_">View</span>.OnClickListener &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Flag_listenser</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View param1View)</span> &#123;</span><br><span class="line">      <span class="type">MainActivity</span> <span class="variable">mainActivity</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>;</span><br><span class="line">      mainActivity.Globalhit--;</span><br><span class="line">      MainActivity.<span class="built_in">this</span>.checkSignature();</span><br><span class="line">      <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">      stringBuilder.append(<span class="string">&quot;);</span></span><br><span class="line"><span class="string">      stringBuilder.append(Integer.toString(MainActivity.this.Globalhit));</span></span><br><span class="line"><span class="string">      stringBuilder.append(&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> stringBuilder.toString();</span><br><span class="line">      ((TextView)MainActivity.<span class="built_in">this</span>.findViewById(<span class="number">2131165419</span>)).setText(str);</span><br><span class="line">      <span class="keyword">if</span> (MainActivity.<span class="built_in">this</span>.Globalhit == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>((Context)MainActivity.<span class="built_in">this</span>, FlagActivity.class);</span><br><span class="line">        MainActivity.<span class="built_in">this</span>.startActivity(intent);</span><br><span class="line">      &#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Globalhit &#x3D; 999999，用listener来监听点击事件，每点击一次Globalhit减1，当Globalhit &#x3D; 0时利用Intent传参调用startActivity()来启动FlagActivity。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FlagActivity.class</span></span><br><span class="line"><span class="keyword">package</span> com.ctfgame.bmzctf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlagActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span>[] encF = <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; </span><br><span class="line">      <span class="number">4</span>, <span class="number">5</span>, <span class="number">30</span>, <span class="number">27</span>, <span class="number">9</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">53</span>, <span class="number">43</span>, <span class="number">15</span>, </span><br><span class="line">      <span class="number">70</span>, <span class="number">90</span>, <span class="number">85</span>, <span class="number">14</span>, <span class="number">25</span>, <span class="number">9</span>, <span class="number">78</span>, <span class="number">54</span>, <span class="number">83</span>, <span class="number">96</span>, </span><br><span class="line">      <span class="number">25</span>, <span class="number">23</span>, <span class="number">19</span>, <span class="number">115</span>, <span class="number">25</span>, <span class="number">49</span>, <span class="number">77</span>, <span class="number">75</span>, <span class="number">29</span>, <span class="number">28</span>, </span><br><span class="line">      <span class="number">4</span>, <span class="number">122</span>, <span class="number">96</span>, <span class="number">110</span>, <span class="number">56</span>, <span class="number">16</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span>[] wocaozheshisha(<span class="type">int</span>[] paramArrayOfint) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= <span class="number">34</span>; i++)</span><br><span class="line">      paramArrayOfint[i + <span class="number">1</span>] = paramArrayOfint[i] ^ paramArrayOfint[i + <span class="number">1</span>]; </span><br><span class="line">    <span class="keyword">return</span> paramArrayOfint;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle paramBundle)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(paramBundle);</span><br><span class="line">    setContentView(<span class="number">2131361822</span>);</span><br><span class="line">    <span class="type">byte</span>[] arrayOfByte = <span class="string">&quot;bmz&quot;</span>.getBytes();</span><br><span class="line">    wocaozheshisha(wocaozheshisha(wocaozheshisha(<span class="built_in">this</span>.encF)));</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="type">int</span>[] arrayOfInt = <span class="built_in">this</span>.encF;</span><br><span class="line">      <span class="keyword">if</span> (i &lt;= arrayOfInt.length - <span class="number">1</span>) &#123;</span><br><span class="line">        arrayOfInt[i] = arrayOfByte[i % <span class="number">3</span>] ^ arrayOfInt[i];</span><br><span class="line">        i++;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125; </span><br><span class="line">      <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="built_in">this</span>.encF.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        stringBuilder.append(str);</span><br><span class="line">        stringBuilder.append((<span class="type">char</span>)<span class="built_in">this</span>.encF[i]);</span><br><span class="line">        str = stringBuilder.toString();</span><br><span class="line">      &#125; </span><br><span class="line">      ((TextView)findViewById(<span class="number">2131165420</span>)).setText(str);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后打印出的是encF中的字符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">encF = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">30</span>, <span class="number">27</span>, <span class="number">9</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">53</span>, <span class="number">43</span>, <span class="number">15</span>, <span class="number">70</span>, <span class="number">90</span>, <span class="number">85</span>, <span class="number">14</span>, <span class="number">25</span>, <span class="number">9</span>, <span class="number">78</span>, <span class="number">54</span>, <span class="number">83</span>, <span class="number">96</span>, <span class="number">25</span>, <span class="number">23</span>, <span class="number">19</span>, <span class="number">115</span>, <span class="number">25</span>, <span class="number">49</span>, <span class="number">77</span>, <span class="number">75</span>, <span class="number">29</span>, <span class="number">28</span>, <span class="number">4</span>, <span class="number">122</span>, <span class="number">96</span>, <span class="number">110</span>, <span class="number">56</span>, <span class="number">16</span> ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wocaozheshisha</span>(<span class="params">paramArrayOfint</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">35</span>):</span><br><span class="line">      paramArrayOfint[i + <span class="number">1</span>] = paramArrayOfint[i] ^ paramArrayOfint[i + <span class="number">1</span>]; </span><br><span class="line">    <span class="keyword">return</span> paramArrayOfint</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">    new_encF = wocaozheshisha(wocaozheshisha(wocaozheshisha(encF)))</span><br><span class="line">    arrayOfInt = <span class="built_in">len</span>(new_encF)</span><br><span class="line">    arrayOfByte = <span class="string">&quot;bmz&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, arrayOfInt):</span><br><span class="line">        new_encF[i] = <span class="built_in">ord</span>(arrayOfByte[i % <span class="number">3</span>]) ^ new_encF[i]</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> new_encF:</span><br><span class="line">        flag += <span class="built_in">chr</span>(j)</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(attack())</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;Every0ne-0f-BMZCTF-1s-3he-Best&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Crypto-xor"><a href="#Crypto-xor" class="headerlink" title="Crypto_xor"></a>Crypto_xor</h3><p>hint： [‘\x00’,’\x00’,’\x00’] at start of xored is the best hint you get.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xored = [<span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;\x18&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;\x05&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;\x17&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;@&#x27;</span>, <span class="string">&#x27;\x03&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;\x02&#x27;</span>, <span class="string">&#x27;\x07&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;\x02&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;\x12&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;\x07&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;\x15&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;\x11&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;\x05&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;\x02&#x27;</span>, <span class="string">&#x27;\x17&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;\x04&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;\x04&#x27;</span>, <span class="string">&#x27;\x07&#x27;</span>, <span class="string">&#x27;\x15&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;\x1b&#x27;</span>]</span><br><span class="line">s1 = <span class="string">&quot;&quot;</span></span><br><span class="line">s2 = <span class="string">&quot;&quot;</span></span><br><span class="line">a_list = [<span class="built_in">chr</span>(<span class="built_in">ord</span>(a) ^ <span class="built_in">ord</span>(b)) <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(s1, s2)]</span><br><span class="line"><span class="built_in">print</span>(a_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(a_list))</span><br></pre></td></tr></table></figure>

<p>提示说3个\x00是关键提示，我寻思不就是相同异或为0吗…虽然s1s2是可打印字符串，但只知道异或的值构造flag好像又有点说不过去。flag开头固定字符长度为3的只有’ctf’，len(xored) &#x3D; 69是3的倍数，只好猜想s1或s2中是’ctf’重复23次。(总之有点迷)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s1 = [<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;f&#x27;</span>] * <span class="number">23</span></span><br><span class="line">s2 = [<span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;\x18&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;\x05&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;\x17&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;@&#x27;</span>, <span class="string">&#x27;\x03&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;\x02&#x27;</span>, <span class="string">&#x27;\x07&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;\x02&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;\x12&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;\x07&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;\x15&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;\x11&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;\x05&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;\x02&#x27;</span>, <span class="string">&#x27;\x17&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;\x04&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;\x04&#x27;</span>, <span class="string">&#x27;\x07&#x27;</span>, <span class="string">&#x27;\x15&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;\x1b&#x27;</span>]</span><br><span class="line">a_list = [<span class="built_in">chr</span>(<span class="built_in">ord</span>(a) ^ <span class="built_in">ord</span>(b)) <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(s1, s2)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(a_list))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ctf&#123;79f107231696395c004e87dd7709d3990f0d602a57e9f56ac428b31138bda258&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Crypto-easy-crypto"><a href="#Crypto-easy-crypto" class="headerlink" title="Crypto_easy_crypto"></a>Crypto_easy_crypto</h3><p>变过形的RSA。题目代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">nbit</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p, q, r = [getPrime(nbit) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">        <span class="keyword">if</span> isPrime(p + q + r):</span><br><span class="line">            pubkey = (p * q * r, p + q + r)</span><br><span class="line">            privkey = (p, q, r)</span><br><span class="line">            <span class="keyword">return</span> pubkey, privkey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, pubkey</span>):</span><br><span class="line">    enc = <span class="built_in">pow</span>(bytes_to_long(msg.encode(<span class="string">&#x27;utf-8&#x27;</span>)), <span class="number">0x10001</span>, pubkey[<span class="number">0</span>] * pubkey[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line">nbit = <span class="number">512</span></span><br><span class="line">pubkey, _ = keygen(nbit)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;pubkey =&#x27;</span>, pubkey)</span><br><span class="line"></span><br><span class="line">enc = encrypt(flag, pubkey)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;enc =&#x27;</span>, enc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pubkey = (763929224901239050077647342425144363318006219360210465113458622937882119766705458273788947718911994090187932947694326848868575500906975653763043489419853300731695950407389203582333794360159494405111004208058198680365172060235321945875374635278292661761319773173838900295933943437761251440819434675631450032782188481758975272071015244168751016874668742536151359822585793537758876078350987062972237271763834743266722655055439868971805843593929839097963319788083763, 27750416681837900468631425875797804482827864226099175414717825894823303299159277202974070903630276868248755642608884903122768656427165401563920443482151217)</span></span><br><span class="line"><span class="comment"># enc = 7579294603035135817234501131256282324240132424272000903035801073847222917306092792610406876451698121956232047031639448767323475088170357863653435096746640609325525035329328626562143049656124241263576649974820533800161432666946327226418036826146160288273175521864687122720836795596635067761146519940441817765732160382018434465776749372209181212817247187474685246156193381822044772746654690126746715728166527274933634750443478682812664022009444348448955720226579468781927776133336045525149203384137859868153077820708167146052429014790660921586958660759949399826568136755816563468739111123761288318276379025018708883521</span></span><br></pre></td></tr></table></figure>

<p>加密过程$\mathsf{\scriptsize m^{e}\equiv c(mod;pqr(p+q+r))}$因为$\mathsf{\scriptsize p,q,r,p+q+r}$两两互质，因此等价于4个同余式：</p>
<p>$$\mathsf{\small \left{\begin{matrix}m^{e}\equiv c(mod;p) \ m^{e}\equiv c(mod;q) \ m^{e}\equiv c(mod;r) \ m^{e}\equiv c(mod;p+q+r) \end{matrix}\right.}$$</p>
<p>注意到$\mathsf{\scriptsize m^{e}\equiv c(mod;p+q+r)}$中$\mathsf{\scriptsize p+q+r}$已知，由于$\mathsf{\scriptsize p+q+r}$为素数，则有$\mathsf{\scriptsize (e,p+q+r)&#x3D;1}$，因此存在$\mathsf{\scriptsize d}$使得$\mathsf{\scriptsize ed\equiv 1(mod;p+q+r-1)}$。计算$\mathsf{\scriptsize d}$用来解密：$\mathsf{\scriptsize m\equiv c^{d}(mod;p+q+r)}$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">b = <span class="number">27750416681837900468631425875797804482827864226099175414717825894823303299159277202974070903630276868248755642608884903122768656427165401563920443482151217</span></span><br><span class="line">phi = b - <span class="number">1</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">d = gmpy2.invert(e, phi)</span><br><span class="line">enc = <span class="number">7579294603035135817234501131256282324240132424272000903035801073847222917306092792610406876451698121956232047031639448767323475088170357863653435096746640609325525035329328626562143049656124241263576649974820533800161432666946327226418036826146160288273175521864687122720836795596635067761146519940441817765732160382018434465776749372209181212817247187474685246156193381822044772746654690126746715728166527274933634750443478682812664022009444348448955720226579468781927776133336045525149203384137859868153077820708167146052429014790660921586958660759949399826568136755816563468739111123761288318276379025018708883521</span></span><br><span class="line"><span class="comment"># d = 4700510789097495050159107964161182653522012310205333571551682030889932250850163056444682562540239918129139820080278793804505162808763952008195078247331441</span></span><br><span class="line">m = <span class="built_in">pow</span>(enc, d, b)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br><span class="line"><span class="comment"># BMZCTF&#123;9d8ef46w59c4-4s5w-8d4a-w9d5-5dq78e9d&#125;</span></span><br></pre></td></tr></table></figure>


    </div>

</div>
                <div class="footer">
    <span>Copyright © 2022 姜姜酱</span>
    <span>@QSANG</a></span>
</div>


<link rel="stylesheet" href="/css/a11y-dark.min.css">


<script src="/js/highlight.min.js"></script>


<script src="/js/highlightjs-line-numbers.js"></script>


<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>

            </div>
        </div>
    </body>
</html>